import React, { useState } from 'react';
import { View, Text, TextInput, StyleSheet, SafeAreaView, Alert, TouchableOpacity } from 'react-native';
import CustomButton from '../../components/CustomButton';

// Apuntamos a nuestro backend que corre en Docker
const API_URL = 'http://10.0.2.2:8000'; 
// NOTA: Usamos 10.0.2.2 porque es la dirección especial que el emulador de Android usa para hablar con el 'localhost' de tu computador.

const LoginScreen = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [nombre, setNombre] = useState('');

  const handleRegister = async () => {
    if (!nombre || !email || !password) {
      Alert.alert('Error', 'Por favor, completa todos los campos.');
      return;
    }
    try {
      const response = await fetch(`${API_URL}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: email,
          password: password,
          nombre_completo: nombre,
        }),
      });
      const data = await response.json();
      if (!response.ok) {
        throw new Error(data.detail || 'Algo salió mal en el servidor');
      }
      Alert.alert('¡Registro Exitoso!', `El usuario ${data.email} ha sido creado. ID: ${data.user_id}`);
    } catch (error) {
      Alert.alert('Error de Registro', error.message);
    }
  };

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.content}>
        <Text style={styles.title}>Crea tu cuenta en Carting</Text>
        <TextInput style={styles.input} placeholder="Nombre Completo" value={nombre} onChangeText={setNombre} />
        <TextInput style={styles.input} placeholder="Email" value={email} onChangeText={setEmail} keyboardType="email-address" autoCapitalize="none" />
        <TextInput style={styles.input} placeholder="Contraseña" value={password} onChangeText={setPassword} secureTextEntry />
        <CustomButton title="Crear Cuenta" type="primary" onPress={handleRegister} />
        <TouchableOpacity>
           <Text style={styles.footerText}>
            ¿Ya tienes una cuenta? <Text style={styles.linkText}>Inicia Sesión</Text>
           </Text>
        </TouchableOpacity>
      </View>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
    container: { flex: 1, backgroundColor: '#FFFFFF' },
    content: { flex: 1, justifyContent: 'center', padding: 24 },
    title: { fontSize: 28, fontWeight: 'bold', textAlign: 'center', marginBottom: 32 },
    input: { borderWidth: 1, borderColor: '#E0E0E0', borderRadius: 12, padding: 16, fontSize: 16, marginBottom: 16 },
    footerText: { textAlign: 'center', marginTop: 24, color: '#606060' },
    linkText: { color: '#007AFF', fontWeight: 'bold' }
});

export default LoginScreen;